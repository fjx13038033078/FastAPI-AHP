# AHP风险评估系统 - 部署说明

## 项目完成情况

✅ **已完成的功能:**

1. **指标信息接口** (`/api/indicators`)
   - 返回6个风险评估指标的详细信息
   - 包含指标名称、描述、分类等信息

2. **风险评估接口** (`/api/risk/evaluate`)
   - 接收指标数据并进行风险评估计算
   - 生成详细的风险报告和PDF文件
   - 返回符合需求规范的JSON响应

3. **PDF报告生成**
   - 自动生成风险评估PDF报告
   - 包含基本信息、详细评估结果、对策建议等

4. **Docker部署支持**
   - 完整的Dockerfile和docker-compose.yml
   - 支持容器化部署

## 快速部署指南

### 方式一：本地部署

1. **安装依赖:**
```bash
pip install -r requirements.txt
```

2. **启动服务:**
```bash
python run.py
```

3. **访问API:**
- API文档: http://localhost:8000/docs
- 健康检查: http://localhost:8000/health

### 方式二：Docker部署

1. **使用Docker Compose (推荐):**
```bash
docker-compose up --build
```

2. **或者手动构建:**
```bash
docker build -t ahp-risk-api .
docker run -p 8000:8000 -v ./reports:/app/reports ahp-risk-api
```

## API使用示例

### 获取指标信息
```bash
curl -X GET "http://localhost:8000/api/indicators"
```

### 风险评估
```bash
curl -X POST "http://localhost:8000/api/risk/evaluate" \
     -H "Content-Type: application/json" \
     -d '{
       "jcxx": {
         "rwmc": "运输任务",
         "pgdwmc": "XX公司"
       },
       "zbxx": {
         "gwzlsfqq": "1",
         "zygwrznxsfcwn": "1",
         "sfczyrdg": "2",
         "gcdzb": "3",
         "sfqbtgzzsc": "2",
         "sfqbcjgaqjy": "1"
       }
     }'
```

## 系统架构

```
fastApiProject/
├── main.py                 # FastAPI主应用
├── models.py              # 数据模型定义
├── indicators_config.py   # 指标配置和风险矩阵
├── risk_evaluator.py      # 风险评估核心逻辑
├── pdf_generator.py       # PDF报告生成器
├── start_server.py        # 服务启动脚本
├── test_modules.py        # 模块功能测试
├── test_api.py           # API接口测试
├── requirements.txt       # Python依赖
├── Dockerfile            # Docker镜像配置
├── docker-compose.yml    # Docker Compose配置
├── test_main.http        # HTTP测试用例
└── reports/              # PDF报告存储目录
```

## 风险评估算法

1. **风险矩阵计算**: 风险值 = 可能性等级 × 危害程度等级
2. **风险等级判定**:
   - 轻微风险: 1-4
   - 一般风险: 5-15  
   - 较大风险: 16-64
   - 特大风险: 65-100
3. **总体风险**: 取各指标最高风险值

## 技术特性

- ✅ Python FastAPI框架
- ✅ RESTful API设计
- ✅ Pydantic数据验证
- ✅ ReportLab PDF生成
- ✅ Docker容器化
- ✅ 完整的API文档
- ✅ 健康检查接口
- ✅ 错误处理机制

## 注意事项

1. **PDF报告路径**: 报告保存在 `reports/` 目录下
2. **端口配置**: 默认使用8000端口，可在配置中修改
3. **中文支持**: 系统完全支持中文内容处理
4. **扩展性**: 指标配置可在 `indicators_config.py` 中轻松扩展

## 开发验证

系统已通过以下测试：
- ✅ 模块导入测试
- ✅ 风险评估逻辑测试  
- ✅ PDF报告生成测试（符合标准格式）
- ✅ API响应格式验证
- ✅ Docker构建测试

## PDF报告特性

新版PDF报告完全符合提供的模板格式：
- ✅ 封面页：包含密级、编号、标题、日期、基本信息表格
- ✅ 内容页：评估依据、内容描述、程序方法、分析建议
- ✅ 详细表格：每个风险指标的完整评估信息
- ✅ 签字页：组长签字和业务主管部门意见

## 技术支持

如有问题，请检查：
1. Python版本 (建议3.9+)
2. 依赖包安装完整性
3. 端口8000是否被占用
4. reports目录是否有写入权限 